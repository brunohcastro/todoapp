<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>

    <title>TODO App</title>

    <!-- Bootstrap Core CSS -->
    <h:outputStylesheet library="webjars" name="bootstrap/4.3.1/css/bootstrap.min.css"/>

    <!-- FontAwesome -->
    <h:outputStylesheet library="webjars" name="font-awesome/5.8.1/css/all.min.css"/>

    <!-- Custom CSS -->
    <link href="#{facesContext.externalContext.requestContextPath}/resources/css/main.css" rel="stylesheet"/>

    <!-- HTML5 Shim and Respond.js IE8 core of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</h:head>
<h:body class="text-center">

    <div class="cover-container d-flex h-100 p-3 mx-auto flex-column">
        <main class="inner cover">
            <h:form id="todoForm" autocomplete="off">
                <div class="input-group mb3">
                    <p:inputText
                            id="content"
                            value="#{todoController.todo.description}"
                            styleClass="todo-input"
                            placeholder="Qual a próxima tarefa?"
                            autocomplete="off"
                    />

                    <div class="input-group-append">
                        <p:commandButton
                                styleClass="todo-add"
                                update="@form :todoList"
                                action="#{todoController.createTodo}"
                                icon="ui-icon-check"
                        />
                    </div>
                </div>
            </h:form>

            <p:dataList
                    id="todoList"
                    var="todo"
                    value="#{todoController.todos}"
                    type="unordered"
                    itemType="none"
                    emptyMessage=""
            >
                <h:panelGroup layout="block" id="todoItem" class="todo-item">
                    <h:form layout="block" class="input-group" rendered="#{todoController.isEditing(todo)}">
                        <p:defaultCommand target="save"/>
                        <div class="input-group-prepend">
                            <p:commandButton
                                    styleClass="edit-cancel"
                                    update=":todoList:todoItem"
                                    action="#{todoController.cancelEdit}"
                                    icon="ui-icon-close"
                                    id="edit-cancel"
                            />
                        </div>
                        <p:inputText
                                id="editing"
                                value="#{todoController.selected.description}"
                                styleClass="todo-edit"
                                autocomplete="off"
                        />
                        <p:hotkey global="" bind="esc" update=":todoList" action="#{todoController.cancelEdit}"/>
                        <div class="input-group-append">
                            <p:commandButton
                                    id="save"
                                    styleClass="todo-save"
                                    update=":todoList"
                                    action="#{todoController.saveTodo(todo)}"
                                    icon="ui-icon-save"
                            />
                        </div>
                    </h:form>
                    <h:form layout="block" class="input-group" rendered="#{!todoController.isEditing(todo)}">
                        <h:selectBooleanCheckbox
                                styleClass="todo-status"
                                value="#{todo.completed}"
                                id="complete"
                        >
                            <p:ajax
                                    event="change"
                                    listener="#{todoController.saveTodo(todo)}"
                                    update=":todoList:todoItem"

                            />
                        </h:selectBooleanCheckbox>
                        <h:outputLabel class="checkbox" for="complete">
                            <h:outputText styleClass="check" rendered="#{todo.completed}"/>
                            <h:outputText styleClass="box" rendered="#{!todo.completed}"/>
                        </h:outputLabel>
                        <h:outputLabel
                                class="todo-content"
                                id="todo"
                        >
                            #{todo.description}
                            <p:ajax
                                    event="dblclick"
                                    listener="#{todoController.editTodo(todo)}"
                                    oncomplete="focusFix(jQuery('.todo-edit'))"
                                    update=":todoList"

                            />
                        </h:outputLabel>
                        <div class="input-group-append">
                            <p:commandButton
                                    styleClass="remove"
                                    update=":todoList"
                                    action="#{todoController.removeTodo(todo)}"
                                    icon="ui-icon-trash"
                            />

                        </div>
                    </h:form>
                </h:panelGroup>
            </p:dataList>
        </main>

        <footer class="mastfoot mt-auto">
            <div class="inner">
                <p>Feito com ❤ por <a href="mailto://brunohcastro@gmail.com">Bruno Castro</a>, <a
                        href="https://twitter.com/brunohcastro">@brunohcastro</a>.</p>
            </div>
        </footer>
    </div>

    <script>
        function focusFix(input) {
            input.focus();
            var tmpStr = input.val();
            input.val('');
            input.val(tmpStr);
        }
    </script>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <h:outputScript library="primefaces" name="jquery/jquery.js"/>
    <!-- <script src="../../assets/js/vendor/popper.min.js"></script> -->
    <!-- Bootstrap Core JavaScript -->
    <h:outputScript library="webjars" name="bootstrap/4.3.1/js/bootstrap.min.js"/>
</h:body>
</html>
